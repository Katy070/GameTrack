{% extends 'base.html' %}
{% load static %}

{% block title %}Edit Profile{% endblock %}

{% block content %}
<div class="edit-profile-container">
  <h2>Edit Your Profile</h2>

  <form method="post" enctype="multipart/form-data" class="edit-profile-form">
    {% csrf_token %}

    <h4>Account Info</h4>
    {% for field in user_form %}
      <div class="form-group">
        {{ field.label_tag }}
        {{ field }}
        {% if field.errors %}
          <div class="error">{{ field.errors }}</div>
        {% endif %}
      </div>
    {% endfor %}

    <h4>Profile Info</h4>
    {% for field in profile_form %}
      <div class="form-group">
        {{ field.label_tag }}
        {{ field }}
        {% if field.errors %}
          <div class="error">{{ field.errors }}</div>
        {% endif %}
      </div>
    {% endfor %}

    <div class="avatar-preview">
      <label>Current Avatar:</label><br>
      {% if user.profile.profile_picture %}
        <img id="avatarPreview" src="{{ user.profile.profile_picture.url }}" alt="Avatar" width="150">
      {% else %}
        <img id="avatarPreview" src="{% static 'media/default-avatar.png.jpg' %}" alt="Default Avatar" width="150">
      {% endif %}
    </div>

    <button type="submit" class="btn btn-primary">Save Changes</button>
    <a href="{% url 'profile' %}" class="btn btn-secondary">Cancel</a>
  </form>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const input = document.getElementById("id_profile_picture");
    const preview = document.getElementById("avatarPreview");

    if (input && preview) {
      input.addEventListener("change", function () {
        const file = input.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            preview.src = e.target.result;
          };
          reader.readAsDataURL(file);
        }
      });
    }
  });
</script>
{% endblock %}

